var SUPER=SUPER||{};SUPER.SIC=SUPER.SIC||{};SUPER.SIC.Models=SUPER.SIC.Models||{};SUPER.SIC.Models.Documento=function(){"use strict";function n(n){this.ta210_iddocupreventa=n.ta210_iddocupreventa||0;this.t2_iddocumento=n.t2_iddocumento||null;this.ta210_destino=n.ta210_destino||"";this.ta210_descripcion=n.ta210_descripcion||"";this.ta210_nombrefichero=n.ta210_nombrefichero||"";this.ta210_kbytes=n.ta210_kbytes||0;this.ta210_fechamod=n.ta210_fechamod||new Date;this.ta204_idaccionpreventa=n.ta204_idaccionpreventa||null;this.ta207_idtareapreventa=n.ta207_idtareapreventa||null;this.ta207_denominacion=n.ta207_denominacion||"";this.t001_idficepi_autor=n.t001_idficepi_autor||0;this.ta211_idtipodocumento=n.ta211_idtipodocumento||0;this.ta211_denominacion=n.ta211_denominacion||"";this.ta210_guidprovisional=n.ta210_guidprovisional||null;this.autor=n.autor||"";this.fileupdated=n.fileupdated||!1;this.editable=n.editable||!1;this.container=n.container||"";this.origenEdicion=n.origenEdicion||"";this.estado=n.estado||""}return n.fromJson=function(t){return new n(t)},n.create=function(){return new n({})},n.prototype.equals=function(n){return this.ta210_iddocupreventa===n.ta210_iddocupreventa},n}();SUPER=SUPER||{};SUPER.SIC=SUPER.SIC||{};SUPER.SIC.Models=SUPER.SIC.Models||{};SUPER.SIC.Models.DocumentoList=function(){"use strict";function n(n){this._documentos=n}return n.create=function(t){return new n(t)},n.prototype.all=function(){return this._documentos},n.prototype.size=function(){return this._documentos.length},n.prototype.add=function(n){this._documentos.push(n)},n.prototype.update=function(n){$.extend(this.get(n.ta210_iddocupreventa),n)},n.prototype.delete=function(n){var t=this._documentos.indexOf(n);return this._documentos.splice(t,1)},n.prototype.get=function(n){var t=this._documentos.filter(function(t){return t.ta210_iddocupreventa==n});if(t.length==0)return null;if(t.length==1)return t[0];throw"Multiple items with same id.";},n}();SUPER=SUPER||{};SUPER.SIC=SUPER.SIC||{};SUPER.SIC.viewDocumentos=function(n){function b(n,t,i){$(t).on(n,i)}function k(n,t,i){$(document).on(n,t,i)}function d(n,t){l=n;e=t}function g(i){var u=$.Deferred();return t.modalCatalogo.length==0?($("<link/>",{rel:"stylesheet",type:"text/css",href:IB.vars.strserver+"Capa_Presentacion/SIC/Documentos/StyleSheet.css"}).appendTo("head"),$.get(IB.vars.strserver+"Capa_Presentacion/SIC/Documentos/Template.html",function(f){$("body").append(f);var e={modalCatalogo:$("#modalDocumentacionCatalogo"),litab1:$("#litab1"),litab2:$("#litab2"),divtab1:$("#divtab1"),divtab2:$("#divtab2"),listaDocumentosAdd:$("#divListaDocumentosAdd"),listaDocumentosRead:$("#divListaDocumentosRead"),detalleDocumento:$("#divDetalleDocumento"),tabAccionCount:$("#tabAccionCount"),tabTareaCount:$("#tabTareaCount"),chkMostrarOperativos:$("#chkMostrarOperativos"),chkMostrarResultado:$("#chkMostrarResultado"),modalEdicion:$("#modalDocumentacionEdicion"),destino:$("input[name='mde-destino']"),documento:$("#mde-documento"),autor:$("#mde-autor"),fileuploaderplugin:$("#mde-fileuploaderplugin"),tipodocumento:$("#mde-tipodocumento"),descripcion:$("#mde-descripcion")};$.extend(t,e);c(n.Documento.create());t.detalleDocumento.on("click",".fk_download",p);t.modalEdicion.on("click",".fa-download",p);t.chkMostrarOperativos.on("change",function(){h();r()});t.chkMostrarResultado.on("change",function(){h();r()});lt(i,t.tipodocumento);ot();u.resolve()}),$("body").append("<iframe id='ifrmDownloadDoc' scrolling='no' marginheight='0' marginwidth='0' frameborder='0' style='display: none;'><\/iframe>"),t.ifrmDownloadDoc=$("#ifrmDownloadDoc")):u.resolve(),u.promise()}function nt(n){var u,f,i;o=n;t.litab1.css("display","block");t.litab2.css("display","block");t.litab1.removeClass("active");t.litab2.removeClass("active");t.divtab1.removeClass("active");t.divtab2.removeClass("active");l=="accionpreventa"?(t.litab1.addClass("active"),t.divtab1.addClass("active"),e&&t.litab2.css("display","none")):(t.litab2.addClass("active"),t.divtab2.addClass("active"),e&&t.litab1.css("display","none"));t.divtab1.html("");t.divtab2.html("");typeof n.containerAccion!="undefined"&&(u=n.containerAccion.modo=="E"?t.listaDocumentosAdd.html():t.listaDocumentosRead.html(),f=n.containerAccion.ext==!0?t.docCardExt:t.docCard,i=new StringBuilder,n.containerAccion.lstDocumentos.all().map(f).forEach(function(n){i.append(n)}),t.divtab1.append(u),t.divtab1.find(".list-group").append(i.toString()),t.divtab1.find(".fk_title").text(n.containerAccion.titulo),t.divtab1.find(".fk_btnAdjuntar").attr("data-container","accionpreventa"),n.containerAccion.lstDocumentos.size()==0?t.divtab1.find(".fk_nodoc").css("display","block"):t.divtab1.find(".fk_nodoc").css("display","none"));typeof n.containerTarea!="undefined"&&(u=n.containerTarea.modo=="E"?t.listaDocumentosAdd.html():t.listaDocumentosRead.html(),f=n.containerTarea.ext==!0?t.docCardExt:t.docCard,i=new StringBuilder,n.containerTarea.lstDocumentos.all().map(f).forEach(function(n){i.append(n)}),t.divtab2.append(u),t.divtab2.find(".list-group").append(i.toString()),t.divtab2.find(".fk_title").text(n.containerTarea.titulo),t.divtab2.find(".fk_btnAdjuntar").attr("data-container","tareapreventa"),n.containerTarea.lstDocumentos.size()==0?t.divtab2.find(".fk_nodoc").css("display","block"):t.divtab2.find(".fk_nodoc").css("display","none"));h();r()}function h(){t.chkMostrarOperativos.is(":checked")?(t.divtab1.find("a.list-group-item[data-ta210_destino='O']").css("display","block"),t.divtab2.find("a.list-group-item[data-ta210_destino='O']").css("display","block")):(t.divtab1.find("a.list-group-item[data-ta210_destino='O']").css("display","none"),t.divtab2.find("a.list-group-item[data-ta210_destino='O']").css("display","none"));t.chkMostrarResultado.is(":checked")?(t.divtab1.find("a.list-group-item[data-ta210_destino='R']").css("display","block"),t.divtab2.find("a.list-group-item[data-ta210_destino='R']").css("display","block")):(t.divtab1.find("a.list-group-item[data-ta210_destino='R']").css("display","none"),t.divtab2.find("a.list-group-item[data-ta210_destino='R']").css("display","none"))}function tt(){t.modalCatalogo.modal("show")}function it(n,i){var u=$(t.docCard(n)).css("display","none");i=="accionpreventa"?t.divtab1.find(".list-group").prepend(u):i=="tareapreventa"&&t.divtab2.find(".list-group").prepend(u);t.modalCatalogo.find("a.fk_documentoCard[data-ta210_iddocupreventa='"+n.ta210_iddocupreventa+"']").parent().slideDown(function(){r()});r()}function rt(n){var i,r,u;n.container=="accionpreventa"?i=o.containerAccion.ext:n.container=="tareapreventa"&&(i=o.containerTarea.ext);r=i==!0?t.docCardExt:t.docCard;u=t.modalCatalogo.find(".fk_documentoCard[data-ta210_iddocupreventa="+n.ta210_iddocupreventa+"]").parent();$(u).html(r(n)).css("display","none").fadeIn("slow")}function ut(i){t.modalCatalogo.find("a.fk_documentoCard[data-ta210_iddocupreventa='"+i+"']").parent().slideUp(function(){$(this).remove();r()});c(n.Documento.create());r()}function ft(n){var i=t.modalCatalogo.find(".fk_documentoCard[data-ta210_iddocupreventa="+n+"]");i.trigger("click")}function v(n){switch(n){case"O":return"Operativo";case"R":return"Resultado"}}function y(n){var i=n.substr(n.lastIndexOf(".")+1),t="";switch(i){case"pdf":t="<i class='fa fa-3x fa-file-pdf-o text-danger pull-left' aria-hidden='true'><\/i>";break;case"xls":case"xlsx":t="<i class='fa fa-3x fa-file-excel-o text-success pull-left' aria-hidden='true'><\/i>";break;case"doc":case"docx":t="<i class='fa fa-3x fa-file-word-o text-primary pull-left' aria-hidden='true'><\/i>";break;case"ppt":case"pptx":t="<i class='fa fa-3x fa-file-powerpoint-o text-primary pull-left' aria-hidden='true'><\/i>";break;case"zip":case"rar":t="<i class='fa fa-3x fa-file-archive-o text-primary pull-left' aria-hidden='true'><\/i>";break;default:t="<i class='fa fa-3x fa-file-o text-primary pull-left' aria-hidden='true'><\/i>"}return t}function r(){t.tabAccionCount.text(t.divtab1.find("a.list-group-item").filter(function(){return this.style&&this.style.display==="block"}).length);t.tabTareaCount.text(t.divtab2.find("a.list-group-item").filter(function(){return this.style&&this.style.display==="block"}).length)}function et(n){t.modalCatalogo.find("a.list-group-item").removeClass("active");t.modalCatalogo.find("a.list-group-item[data-ta210_iddocupreventa='"+n+"']").addClass("active")}function c(n){$("#dd_nombre").text(n.ta210_nombrefichero);$("#dd_tamano").text(n.ta210_kbytes.toLocaleString()+" KB");$("#dd_fecha").text(moment(n.ta210_fechamod).format("DD/MM/YYYY HH:mm"));$("#dd_autor").text(n.autor);$("#dd_destino").text(n.ta210_destino=="O"?"Operativo":"Resultado");$("#dd_tipo").text(n.ta211_denominacion);$("#dd_descripcion").text(n.ta210_descripcion);n.editable?($(u.btnEditar).removeAttr("disabled","disabled").removeClass("disabled"),$(u.btnEliminar).removeAttr("disabled","disabled").removeClass("disabled")):($(u.btnEditar).attr("disabled","disabled").addClass("disabled"),$(u.btnEliminar).attr("disabled","disabled").addClass("disabled"));n.ta210_iddocupreventa==0?($("#divDetalleDocumento").css("display","none"),s=null):($("#divDetalleDocumento").css("display","none").fadeIn(),s=n)}function p(){var n=IB.vars.strserver+"Capa_Presentacion/SIC/Documentos/FileDownload.ashx?"+IB.uri.encode("t2_iddocumento="+s.t2_iddocumento);t.ifrmDownloadDoc.prop("src",n).submit()}function ot(){console.log("initUploadPlugin()");t.fileuploaderplugin.uploadFile({url:IB.vars.strserver+"Capa_Presentacion/SIC/Documentos/FileUpload.ashx",autoSubmit:!0,multiple:!1,maxFileCount:1,dragDrop:!0,fileName:"myfile",returnType:"json",statusBarWidth:"100%",dragdropWidth:"100%",maxFileSize:52428800,showPreview:!1,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!1,showProgress:!0,showDownload:!1,showDelete:!0,customErrorKeyStr:"jquery-upload-file-error",onSuccess:function(n,t){i=t;f=!1},deleteCallback:function(){i=null},onSubmit:function(){f=!0},onError:function(){f=!1}})}function st(n,r){a=r;i=null;t.fileuploaderplugin.reset();r=="E"?(t.destino.filter("[value='"+n.ta210_destino+"']").prop("checked",!0),t.documento.val(n.ta210_nombrefichero+" ("+n.ta210_kbytes.toLocaleString()+" KB)"),t.autor.val(n.autor+" "+moment(n.ta210_fechamod).format("DD/MM/YYYY HH:mm")),t.tipodocumento.val(n.ta211_idtipodocumento),t.descripcion.val(n.ta210_descripcion),t.modalEdicion.find(".modal-title").text("Edición de ficha de documento")):(t.destino.filter("[value='O']").prop("checked",!0),t.documento.val(""),t.autor.val(""),t.tipodocumento.val(""),t.descripcion.val(""),t.modalEdicion.find(".modal-title").text("Adjuntar nuevo documento"));t.modalEdicion.modal("show")}function w(){var r=n.Documento.create();return i!=null&&(r.t2_iddocumento=i.t2_iddocumento,r.ta210_nombrefichero=i.name,r.ta210_kbytes=i.size),r.ta210_destino=t.destino.filter(":checked").val(),r.ta211_idtipodocumento=t.tipodocumento.val(),r.ta210_descripcion=t.descripcion.val(),r}function ht(){var t;if(f)return IB.bsalert.toastdanger("Espera a que finalice la subida del documento al servidor."),!1;var n=!0,r=!0,u=w();return typeof u.ta210_destino=="undefined"&&(n=!1),u.ta211_idtipodocumento.length==0&&(n=!1),u.ta210_descripcion.length==0&&(n=!1),a=="A"&&i==null&&(r=!1),t="",n||r?n?r||(t="Debes seleccionar un documento."):t="Debes cumplimentar todos los campos.":t="Debes cumplimentar todos los campos y seleccionar un documento.",t.length>0&&IB.bsalert.toastdanger(t),n&&r}function ct(){t.modalEdicion.modal("hide")}function lt(n,i,r){console.log("renderCombo "+i.prop("id"));n.length>1&&n.splice(0,0,{Key:"",Value:"Selecciona..."});at(i);n.map(t.cmboption).forEach(function(n){i.append(n)});r!=undefined&&r!=null?(i.val(r),i.trigger("change")):n.length==1&&(i.find("option").attr("selected","selected"),i.trigger("change"))}function at(n){var t=n.val();n.find("option").remove();n.val("");t!=null&&t!=""&&n.trigger("change")}var l,a,e,o,i=null,f=!1,s;typeof $.fn.uploadFile=="undefined"&&($("<link/>",{rel:"stylesheet",type:"text/css",href:IB.vars.strserver+"plugins/jqueryuploadfile/uploadfile.css"}).appendTo("head"),$.getScript(IB.vars.strserver+"plugins/jqueryuploadfile/jquery.uploadfile.js"));var t={modalCatalogo:$("#modalDocumentacionCatalogo"),modalEdicion:$("#modalDocumentacionEdicion"),detalleDocumento:$("#divDetalleDocumento"),litab1:$("#litab1"),litab2:$("#litab2"),divtab1:$("#divtab1"),divtab2:$("#divtab2"),listaDocumentosAdd:$("#divListaDocumentosAdd"),listaDocumentosRead:$("#divListaDocumentosRead"),ifrmDownloadDoc:$("#ifrmDownloadDoc"),tabAccionCount:$("#tabAccionCount"),tabTareaCount:$("#tabTareaCount"),chkMostrarOperativos:$("#chkMostrarOperativos"),chkMostrarResultado:$("#chkMostrarResultado"),docCard:function(n){var t=new StringBuilder;return t.append("<div><a class='list-group-item fk_documentoCard' style='display:block' href='#' data-ta210_iddocupreventa='"+n.ta210_iddocupreventa+"' data-ta210_destino='"+n.ta210_destino+"'>"),t.append("\t<div class='row'>"),t.append("\t\t<div class='col-sm-12'>"),t.append(y(n.ta210_nombrefichero)),n.editable||t.append("<i class='fa fa-lock pull-right' aria-hidden='true'><\/i>"),t.append("\t\t\t<h4 class='list-group-item-heading'>"+n.ta210_nombrefichero+"<\/h4>"),t.append("\t\t\t<span class='list-group-item-text'>"+moment(n.ta210_fechamod).format("DD/MM/YYYY")+"<\/span>"),t.append("\t\t\t|"),t.append("\t\t\t<span>"+v(n.ta210_destino)+"<\/span>"),t.append("\t\t<\/div>"),t.append("\t<\/div>"),t.append("\t<br />"),t.append("\t<div class='row'>"),t.append("\t\t<div class='col-sm-12'>"),t.append("\t\t\t<p class='list-group-item-text'>"+n.ta210_descripcion.trunc(42)+"<\/p>"),t.append("\t\t<\/div>"),t.append("\t<\/div>"),t.append("<\/a><\/div>"),t.toString()},docCardExt:function(n){var t=new StringBuilder;return t.append("<div><a class='list-group-item fk_documentoCard' style='display:block' href='#' data-ta210_iddocupreventa='"+n.ta210_iddocupreventa+"' data-ta210_destino='"+n.ta210_destino+"'>"),t.append("\t<div class='row'>"),t.append("\t\t<div class='col-sm-12'>"),t.append(y(n.ta210_nombrefichero)),n.editable||t.append("<i class='fa fa-lock pull-right' aria-hidden='true'><\/i>"),t.append("\t\t\t<h4 class='list-group-item-heading'>"+n.ta210_nombrefichero+"<\/h4>"),t.append("\t\t\t<span class='list-group-item-text'>"+moment(n.ta210_fechamod).format("DD/MM/YYYY")+"<\/span>"),t.append("\t\t\t|"),t.append("\t\t\t<span>"+v(n.ta210_destino)+"<\/span>"),t.append("\t\t<\/div>"),t.append("\t<\/div>"),t.append("\t<br />"),t.append("\t<div class='row'>"),t.append("\t\t<div class='col-sm-12'>"),t.append("\t\t\t<p class='list-group-item-text'>"+n.ta210_descripcion.trunc(42)+"<\/p>"),t.append("\t\t\t<p class='list-group-item-text text-primary'>"+n.ta207_denominacion.trunc(42)+"<\/p>"),t.append("\t\t<\/div>"),t.append("\t<\/div>"),t.append("<\/a><\/div>"),t.toString()},cmboption:function(n){return n.Key===""?"<option value='' selected hidden>"+n.Value:"<option value='"+n.Key+"'>"+n.Value},destino:undefined,documento:undefined,autor:undefined,fileuploaderplugin:undefined,tipodocumento:undefined,descripcion:undefined},u={btnDescargar:"#dd_btnDescargar",btnEditar:"#dd_btnEditar",btnEliminar:"#dd_btnEliminar"};return{selectores:{modalCatalogo:"#modalDocumentacionCatalogo",documentoCard:".fk_documentoCard",nuevo:".fk_btnAdjuntar",grabar:".fk_mde-btnGrabar"},dd_selectores:u,attachEvents:b,attachLiveEvents:k,setParams:d,init:g,renderCatalogo:nt,showModalCatalogo:tt,closeModalEdicion:ct,detalleDocumento:c,editarDocumento:st,eliminarDocumento:ut,getModalEdicionValues:w,validarEdicion:ht,addFichaDocumento:it,updateFichaDocumento:rt,selectDocCatalogo:ft,resaltarDocumento:et}}(SUPER.SIC.Models);SUPER=SUPER||{};SUPER.SIC=SUPER.SIC||{};SUPER.SIC.appDocumentos=function(n,t){function it(n,t,r,u,f){return i="accionpreventa",e=n,v=t,a=r,w=u,y=f,o=!1,isNaN(n)&&(o=!0),g()}function rt(n,t,r,u,f){return i="tareapreventa",e=n,v=t,a=r,w=u,y=f,o=!1,isNaN(n)&&(o=!0),g()}function ut(){$.when(et()).then(nt).then(ot)}function ft(){var n=$.Deferred();return $.when(nt()).then(function(t,i){var r=t.size()+i.size();n.resolve(r)}),n.promise()}function g(){var t=$.Deferred(),f;return d?(n.setParams(i,o),t.resolve()):(f={tipo:"tipodocumento_preventa",filtrarPor:null},IB.DAL.post(tt,"ObtenerLista",f,null,function(r){n.setParams(i,o);n.init(r).then(function(){t.resolve()})}),n.attachLiveEvents("click",n.dd_selectores.btnEliminar,ht),n.attachLiveEvents("click",n.dd_selectores.btnEditar,ct),n.attachLiveEvents("click",n.selectores.nuevo,lt),n.attachLiveEvents("click",n.selectores.grabar,vt),n.attachLiveEvents("hidden.bs.modal",n.selectores.modalCatalogo,function(){pt("onClose",r.size()+u.size())}),n.attachLiveEvents("click",n.selectores.documentoCard,st),d=!0),t.promise()}function et(){var n=$.Deferred(),t;if(o)b="A",n.resolve("A");else return t={origenEdicion:i,idorigenEdicion:e},IB.DAL.post(h,"obtenerOrigenEdicionEstado",t,null,function(t){b=t;n.resolve(t)});return n.promise()}function nt(){var n=$.Deferred(),f;if(o)r=t.DocumentoList.create([]),u=t.DocumentoList.create([]),f={GUID:e},IB.DAL.post(h,"CatalogoGUID",f,t.Documento.fromJson,function(f){f.map(function(n){p(n,i)});i=="accionpreventa"&&(r=t.DocumentoList.create(f));i=="tareapreventa"&&(u=t.DocumentoList.create(f));n.resolve(r,u)});else switch(i){case"accionpreventa":var s={origenEdicion:"accionpreventa",idorigenEdicion:e},c=IB.DAL.post(h,"Catalogo",s,t.Documento.fromJson),l={origenEdicion:"tareasaccionpreventa",idorigenEdicion:e},a=IB.DAL.post(h,"Catalogo",l,t.Documento.fromJson);$.when(c,a).then(function(i,f){i.map(function(n){p(n,"accionpreventa")});f.map(function(n){p(n,"tareapreventa")});r=t.DocumentoList.create(i);u=t.DocumentoList.create(f);n.resolve(r,u)});break;case"tareapreventa":var s={origenEdicion:"acciontareapreventa",idorigenEdicion:e},c=IB.DAL.post(h,"Catalogo",s,t.Documento.fromJson),l={origenEdicion:"tareapreventa",idorigenEdicion:e},a=IB.DAL.post(h,"Catalogo",l,t.Documento.fromJson);$.when(c,a).then(function(i,f){i.map(function(n){p(n,"accionpreventa")});f.map(function(n){p(n,"tareapreventa")});r=t.DocumentoList.create(i);u=t.DocumentoList.create(f);n.resolve(r,u)})}return n.promise()}function p(n,t){n.origenEdicion=i;n.container=t;n.editable=!1;t=="accionpreventa"&&v=="E"?(n.t001_idficepi_autor==w||y)&&(n.editable=!0):t=="tareapreventa"&&a=="E"&&(n.t001_idficepi_autor==w||y)&&(n.editable=!0);i=="accionpreventa"&&b=="A"&&y==!0&&t=="tareapreventa"&&a=="E"?n.editable=!0:n.estado!="A"&&(n.editable=!1)}function ot(){var f;if(o)switch(i){case"accionpreventa":f={containerAccion:{lstDocumentos:r,titulo:"Documentación asociada a la acción",modo:v,ext:!1}};break;case"tareapreventa":f={containerTarea:{lstDocumentos:u,titulo:"Documentación asociada a la tarea",modo:a,ext:!1}}}else switch(i){case"accionpreventa":f={containerAccion:{lstDocumentos:r,titulo:"Documentación asociada a la acción",modo:v,ext:!1},containerTarea:{lstDocumentos:u,titulo:"Documentación asociada a las tareas de la acción",modo:"C",ext:!0}};break;case"tareapreventa":f={containerAccion:{lstDocumentos:r,titulo:"Documentación asociada a la acción de la tarea",modo:"C",ext:!1},containerTarea:{lstDocumentos:u,titulo:"Documentación asociada a la tarea",modo:a,ext:!1}}}n.detalleDocumento(t.Documento.create());n.renderCatalogo(f);n.showModalCatalogo()}function st(){f=null;var i=$(this).attr("data-ta210_iddocupreventa"),t=r.get(i);if(t==null&&(t=u.get(i)),t==null){IB.bserror.mostrarAvisoAplicacion("Documentación","Ha ocurrido un error al obtener la información del documento.<div class='text-left' style='margin-top:40px;font-size:12px'>Vuelve a cargar la pantalla y si el problema persiste pónte en contacto con el CAU.<br>Disculpa las molestias.<\/div>");return}f=t;n.resaltarDocumento(i);n.detalleDocumento(t)}function ht(){f!=null&&$.when(IB.bsconfirm.confirm("primary","Eliminar documento","¿Estás seguro que quieres eliminar el documento?")).then(function(){IB.procesando.mostrar();var t={ta210_iddocupreventa:f.ta210_iddocupreventa};IB.DAL.post(h,"Delete",t,null,function(){$.when(IB.procesando.ocultar()).then(function(){f.container=="accionpreventa"?r.delete(f):f.container=="tareapreventa"&&u.delete(f);n.eliminarDocumento(f.ta210_iddocupreventa)})})})}function ct(){f!=null&&(c="E",l=f.container,$.when(at(f.ta210_iddocupreventa)).then(function(t){s=t;n.editarDocumento(t,c)}))}function lt(){c="A";s=t.Documento.create();l=$(this).attr("data-container");n.editarDocumento(null,c,l)}function at(n){var t=$.Deferred(),i;return IB.procesando.mostrar(),i={ta210_iddocupreventa:n},IB.DAL.post(h,"Select",i,null,function(n){$.when(IB.procesando.ocultar()).then(function(){t.resolve(n)})}),t.promise()}function vt(){var t,a;n.validarEdicion()&&(t=n.getModalEdicionValues(),t.ta210_iddocupreventa=s.ta210_iddocupreventa,t.t2_iddocumento==null?(t.t2_iddocumento=s.t2_iddocumento,t.ta210_nombrefichero=s.ta210_nombrefichero,t.ta210_kbytes=s.ta210_kbytes,t.t001_idficepi_autor=s.t001_idficepi_autor):t.fileupdated=!0,t.origenEdicion=i,c=="A"?o?t.ta210_guidprovisional=e:(l=="accionpreventa"&&(t.ta204_idaccionpreventa=e),l=="tareapreventa"&&(t.ta207_idtareapreventa=e)):(t.ta204_idaccionpreventa=s.ta204_idaccionpreventa,t.ta207_idtareapreventa=s.ta207_idtareapreventa,t.ta210_guidprovisional=s.ta210_guidprovisional),IB.procesando.mostrar(),a={oDoc:t},methodName=c=="A"?"Insert":"Update",IB.DAL.post(h,methodName,a,null,function(i){c=="A"&&($.extend(t,i),t.ta210_iddocupreventa=i.ta210_iddocupreventa,t.editable=!0);$.when(IB.procesando.ocultar()).then(function(){c=="A"?l=="accionpreventa"?r.add(t):l=="tareapreventa"&&u.add(t):$.extend(f,i);n.closeModalEdicion();c=="A"?n.addFichaDocumento(t,l):n.updateFichaDocumento(f);n.selectDocCatalogo(t.ta210_iddocupreventa)})}))}function yt(n){k.onClose=n}function pt(n,t){typeof k[n]!="undefined"&&k[n].call(this,t)}var d=!1,h=IB.vars.strserver+"Capa_Presentacion/SIC/Services/Documentos.asmx",tt=IB.vars.strserver+"Capa_Presentacion/SIC/Services/Listas.asmx",i,b,e,v,a,w,y,o,c,l,r=[],u=[],s,f,k={};return{initAccion:it,initTarea:rt,show:ut,count:ft,onClose:yt}}(SUPER.SIC.viewDocumentos,SUPER.SIC.Models);
//# sourceMappingURL=Documentos.min.js.map
